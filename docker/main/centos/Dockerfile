#++++++++++++++++++++++++++++++++++++++
# Centos PHP Docker container
#++++++++++++++++++++++++++++++++++++++
#
# Prebuild images:
#
#   mblaschke/php-boilerplate:centos-7
#
# Official images:
#
#   centos:7 - PHP 5.4
#
#++++++++++++++++++++++++++++++++++++++

FROM mblaschke/php-boilerplate:centos-7

ENV PATH /opt/ansible/bin:/bin:/usr/bin:/sbin:/usr/sbin
ENV PYTHONPATH /opt/ansible/lib
ENV ANSIBLE_LIBRARY /opt/ansible/library

##
# Bootstrap
##

COPY conf/locale.conf      /opt/docker/locale.conf
COPY bin/bootstrap.sh      /opt/docker/bin/bootstrap.sh
COPY bin/provision.sh      /opt/docker/bin/provision.sh
COPY bin/logwatch.sh       /opt/docker/bin/logwatch.sh
COPY bin/dnsmasq.sh        /opt/docker/bin/dnsmasq.sh
COPY provision             /opt/docker/provision/

RUN bash /opt/docker/bin/bootstrap.sh
RUN bash /opt/docker/bin/provision.sh bootstrap

##
# Customization
##

COPY bin/customization.sh  /opt/docker/bin/customization.sh
RUN bash /opt/docker/bin/customization.sh

##
# Config
##

COPY entrypoint.sh         /entrypoint.sh
COPY conf                  /opt/docker/conf/

EXPOSE 9000

VOLUME /docker/
WORKDIR /docker/code/

ENTRYPOINT ["/entrypoint.sh"]
CMD ["supervisord"]
